@model HalloDoc.Entities.ViewModels.CreateShiftViewModel

<div class="modal-header">
    <h5 class="modal-title">Create Shift</h5>
    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
</div>
<form id="myForm" asp-controller="Admin" asp-action="AddShift" style="margin-top:-25px;margin-bottom:-25px;">
    <div class="modal-body m-0" >
        <div class=" d-flex justify-content-center flex-column  ">

            <select asp-for="regionId" id="regionSelect" class="form-select required">
                <option value="">Select Region</option>
                @foreach (var i in Model.regions)
                {
                    <option value="@i.RegionId">@i.Name</option>
                }
            </select>
            <span asp-validation-for="regionId" class="text-danger"></span>

            <select class="form-select mt-1 h-50" name="physicianID" asp-for="physicianId" id="physicianSelect">
                <option value="">Select Physician</option>
            </select>
            <span asp-validation-for="physicianId" class="text-danger"></span>

            <div class="col-lg-12 col-md-12 col-sm-12">
                <div class="form-floating form-group">
                    <input asp-for="ShiftDate" type="date"  class="form-control" placeholder=" ">
                    <label for=" ">Shift Date</label>
                    <span asp-validation-for="ShiftDate" class="text-danger"></span>

                </div>

            </div>
            <div class="col-lg-12 col-md-12 col-sm-12 d-flex justify-content-between">
                <div class="form-floating form-group">
                    <input asp-for="startTime" type="time" class="form-control" placeholder=" ">
                    <label for=" ">Start Time</label>
                    <span asp-validation-for="startTime" class="text-danger"></span>

                </div>
                <div class="form-floating form-group">
                    <input asp-for="endTime" type="time" class="form-control" placeholder=" ">
                    <label for=" ">End Time</label>
                    <span asp-validation-for="endTime" class="text-danger"></span>

                </div>
            </div>
            <div class="d-flex mt-2">
                <div class="form-check form-switch">
                    <label class="form-check-label" for="flexSwitchCheckChecked">Repeat</label>
                    <input class="form-check-input" type="checkbox" role="switch" asp-for="toggle" id="flexSwitchCheckChecked">
                </div>
            </div>
            <div id="CheckBoxDiv">
                <div class="text-muted">
                    Repeat Days
                </div>
                <input class=" my-2 ml-2" type="checkbox" name="WeekDays" value="0">
                <label class=" my-2 mr-2" for="checkboxSun">Every Sunday</label>
                <input class=" my-2 ml-2" type="checkbox" name="WeekDays" value="1">
                <label class=" my-2 mr-2" for="checkboxMon">Every Monday</label>
                <input class=" my-2 ml-2" type="checkbox" name="WeekDays" value="2">
                <label class=" my-2 mr-2" for="checkboxTue">Every Tuesday</label>
                <input class=" my-2 ml-2" type="checkbox" name="WeekDays" value="3">
                <label class=" my-2 mr-2" for="checkboxWed">Every Wednesday</label>
                <input class=" my-2 ml-2" type="checkbox" name="WeekDays" value="4">
                <label class=" my-2 mr-2" for="checkboxThu">Every Thursday</label>
                <input class=" my-2 ml-2" type="checkbox" name="WeekDays" value="5">
                <label class=" my-2 mr-2" for="checkboxFri">Every Friday</label>
                <input class=" my-2 ml-2" type="checkbox" name="WeekDays" value="6">
                <label class=" my-2 mr-2" for="checkboxSat">Every Saturday</label>
            </div>
            <div class="col-lg-6 col-md-6 col-sm-12">
                <div class="form-floating form-group">
                    <select class="form-select mt-1 h-50"  asp-for="repeatEnd" id="repeatEnd">
                        <option value="0" selected>0-Time</option>
                        <option value="1">1-Time</option>
                        <option value="2">2-Time</option>
                        <option value="3">3-Time</option>

                    </select>
                    <label>Repeat End</label>
                    <span asp-validation-for="repeatEnd" class="text-danger"></span>
                </div>

            </div>
        </div>
    </div>
    <div class="modal-footer d-flex justify-content-end">

        <button class="createNewReqBtn submitBtn" type="submit">
            Save
        </button>

        <button type="button" class="createNewReqBtn" data-bs-dismiss="modal">
            Cancle
        </button>


    </div>
</form>
<script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
<script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.0.1/css/toastr.css" rel="stylesheet" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.0.1/js/toastr.js"></script>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    $(document).ready(function () {
        $("#regionSelect").change(function () {
            var regionId = $(this).val();
            var url = "/Admin/GetPhysiciansByRegion?regionId=" + regionId;
            $.ajax({
                url: url,
                type: 'GET',
                dataType: 'json',
                success: function (data) {
                    $("#physicianSelect option").remove();
                    $("#physicianSelect").append('<option value="0" Selected>Select Physician</option>');

                    data.map((x) => {
                        $("#physicianSelect").append('<option value="' + x.physicianId + '">' + x.firstName + '</option>');
                    })
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    console.log(textStatus, errorThrown);
                }
            });
        });
    });



    $('#myForm').on('submit', function (e) {
        e.preventDefault();
        var form = $(this);
        var url = form.attr('action');
        var data = form.serialize();

        $.ajax({
            type: "POST",
            url: url,
            data: data
        })
            .done(function (response) {
                if (response.success) {
                    let timerInterval;
                    Swal.fire({
                        title: "Request Assigned Successfully",
                        icon: "success",
                        timer: 1000,
                        allowOutsideClick: false,
                        showConfirmButton: false,
                    }).then(function () {
                        window.location.href = '@Url.Action("Dashboard", "Admin")';
                    });
                }
            });
    });

</script>

